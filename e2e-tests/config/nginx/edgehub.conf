# Local Edge Hub simulation configuration
server {
    listen 443 ssl http2;
    listen 8883 ssl;
    server_name local-edgehub;

    # Self-signed certificate for local testing
    ssl_certificate /etc/nginx/cert.pem;
    ssl_certificate_key /etc/nginx/key.pem;

    # Basic SSL settings
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # Log connections for debugging
    access_log /var/log/nginx/edgehub_access.log;
    error_log /var/log/nginx/edgehub_error.log;

    # Health check endpoint
    location /health {
        return 200 '{"status":"healthy","service":"local-edgehub"}';
        add_header Content-Type application/json;
    }

    # Mock IoT Hub device endpoints
    location ~* ^/devices/(.+)/modules/(.+)/inputs/(.+) {
        return 200 '{"status":"message_received","device":"$1","module":"$2","input":"$3"}';
        add_header Content-Type application/json;
    }

    # Mock message routing
    location ~* ^/messages/events {
        return 202 '{"status":"accepted","message":"routed"}';
        add_header Content-Type application/json;
    }

    # Default response for all other requests
    location / {
        return 200 '{"status":"local_edgehub","message":"simulation_active"}';
        add_header Content-Type application/json;
    }
}